<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPA 계산기 - CalcHub | 학점 및 평점 계산</title>
    <meta name="description" content="GPA 계산기로 학점과 평점을 간편하게 계산하세요. 한국어 성적 입력 자동 인식.">
    <meta name="keywords" content="GPA계산기, 학점계산, 평점계산, 성적계산">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/common.css">
</head>
<body>
    <!-- 공통 헤더 -->
    <header class="header">
        <div class="header-content">
            <a href="../index.html" class="logo">
                <div class="logo-icon">🧮</div>
                CalcHub
            </a>
            <nav class="nav-links">
                <a href="../index.html#calculators" class="nav-link">계산기</a>
                <a href="../about.html" class="nav-link">소개</a>
                <a href="../contact.html" class="nav-link">문의</a>
            </nav>
        </div>
    </header>

    <div class="container">
        <div class="calculator-card">
            <!-- 계산기 헤더 -->
            <div class="calculator-header">
                <h1 class="calculator-title">🎓 GPA 계산기</h1>
                <p class="calculator-subtitle">학점과 평점을 간편하게 계산하세요</p>
            </div>

            <!-- 계산기 본문 -->
            <div class="calculator-body">
                <!-- 입력 섹션 -->
                <div class="input-section">
                    <h2 class="section-title">📚 성적 입력</h2>
                    <div class="input-grid">
                        <div class="input-group">
                            <label for="subjectData" class="input-label">과목별 성적과 학점</label>
                            <textarea id="subjectData" class="input-field" rows="4" 
                                placeholder="예:&#10;수학 A+ 3학점&#10;영어 B 2학점&#10;물리 A 3학점"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="gradeSystem" class="input-label">학점 체계</label>
                            <select id="gradeSystem" class="input-field" onchange="updateGradeInfo()">
                                <option value="4.5">4.5 만점 (A+ = 4.5)</option>
                                <option value="4.0">4.0 만점 (A+ = 4.0)</option>
                                <option value="100">100점 만점</option>
                            </select>
                        </div>
                    </div>
                    <button onclick="calculate()" class="btn btn-primary">GPA 계산하기</button>
                </div>

                <!-- 결과 섹션 -->
                <div id="resultSection" class="result-section" style="display: none;">
                    <h2 class="result-title">📋 계산 결과</h2>
                    <div class="result-grid">
                        <div class="result-item">
                            <div class="result-label">총 평점 (GPA)</div>
                            <div id="totalGPA" class="result-value highlight">-</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">총 이수 학점</div>
                            <div id="totalCredits" class="result-value">-</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">평점 등급</div>
                            <div id="gradeLevel" class="result-value">-</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 학점 체계 정의
        const gradeSystems = {
            '4.5': {
                'A+': 4.5, 'A': 4.0, 'B+': 3.5, 'B': 3.0, 'C+': 2.5, 'C': 2.0, 'D+': 1.5, 'D': 1.0, 'F': 0
            },
            '4.0': {
                'A+': 4.0, 'A': 4.0, 'A-': 3.7, 'B+': 3.3, 'B': 3.0, 'B-': 2.7, 'C+': 2.3, 'C': 2.0, 'C-': 1.7, 'D+': 1.3, 'D': 1.0, 'F': 0
            },
            '100': {} // 숫자 점수는 별도 처리
        };

        // 학점 체계 정보 업데이트
        function updateGradeInfo() {
            const system = document.getElementById('gradeSystem').value;
            const textarea = document.getElementById('subjectData');
            
            if (system === '100') {
                textarea.placeholder = '예:\n수학 95점 3학점\n영어 87점 2학점\n물리 92점 3학점';
            } else {
                textarea.placeholder = '예:\n수학 A+ 3학점\n영어 B 2학점\n물리 A 3학점';
            }
        }

        // 성적 파싱 함수
        function parseGradeData(input) {
            if (!input) return [];
            
            const lines = input.trim().split('\n');
            const subjects = [];
            
            for (let line of lines) {
                line = line.trim();
                if (!line) continue;
                
                // 정규표현식으로 과목명, 성적, 학점 추출
                let match;
                
                // 패턴 1: "과목명 성적 N학점" (예: 수학 A+ 3학점)
                match = line.match(/(.+?)\s+([A-F][+-]?|\d+점?)\s*(\d+(?:\.\d+)?)\s*학점/);
                if (match) {
                    subjects.push({
                        name: match[1].trim(),
                        grade: match[2].trim(),
                        credits: parseFloat(match[3])
                    });
                    continue;
                }
                
                // 패턴 2: "과목명 N학점 성적" (예: 수학 3학점 A+)
                match = line.match(/(.+?)\s*(\d+(?:\.\d+)?)\s*학점\s+([A-F][+-]?|\d+점?)/);
                if (match) {
                    subjects.push({
                        name: match[1].trim(),
                        grade: match[3].trim(),
                        credits: parseFloat(match[2])
                    });
                    continue;
                }
                
                // 패턴 3: 간단한 형태 (예: A+ 3, 95 3)
                match = line.match(/([A-F][+-]?|\d+점?)\s+(\d+(?:\.\d+)?)/);
                if (match) {
                    subjects.push({
                        name: `과목${subjects.length + 1}`,
                        grade: match[1].trim(),
                        credits: parseFloat(match[2])
                    });
                    continue;
                }
            }
            
            return subjects;
        }

        // 성적을 점수로 변환
        function gradeToPoints(grade, system) {
            const systemData = gradeSystems[system];
            
            if (system === '100') {
                // 숫자 점수 처리
                const score = parseFloat(grade.replace('점', ''));
                if (score >= 97) return 4.5;
                if (score >= 93) return 4.0;
                if (score >= 90) return 3.5;
                if (score >= 87) return 3.0;
                if (score >= 83) return 2.5;
                if (score >= 80) return 2.0;
                if (score >= 77) return 1.5;
                if (score >= 70) return 1.0;
                return 0;
            } else {
                return systemData[grade.toUpperCase()] || 0;
            }
        }

        // 평점을 등급으로 변환
        function getGradeLevel(gpa) {
            if (gpa >= 4.0) return 'A 등급 (우수)';
            if (gpa >= 3.5) return 'B+ 등급 (양호)';
            if (gpa >= 3.0) return 'B 등급 (보통)';
            if (gpa >= 2.5) return 'C+ 등급';
            if (gpa >= 2.0) return 'C 등급';
            if (gpa >= 1.0) return 'D 등급';
            return 'F 등급';
        }

        // 계산 함수
        function calculate() {
            const subjectData = document.getElementById('subjectData').value;
            const gradeSystem = document.getElementById('gradeSystem').value;
            
            if (!subjectData.trim()) {
                alert('성적 정보를 입력해주세요');
                return;
            }

            const subjects = parseGradeData(subjectData);
            
            if (subjects.length === 0) {
                alert('올바른 성적 형식으로 입력해주세요');
                return;
            }

            let totalPoints = 0;
            let totalCredits = 0;

            for (let subject of subjects) {
                const points = gradeToPoints(subject.grade, gradeSystem);
                totalPoints += points * subject.credits;
                totalCredits += subject.credits;
            }

            if (totalCredits === 0) {
                alert('학점이 0이거나 올바르지 않습니다');
                return;
            }

            const gpa = totalPoints / totalCredits;
            const maxGpa = gradeSystem === '4.5' ? 4.5 : 4.0;

            // 결과 표시
            document.getElementById('totalGPA').textContent = `${gpa.toFixed(2)}/${maxGpa}`;
            document.getElementById('totalCredits').textContent = `${totalCredits}학점`;
            document.getElementById('gradeLevel').textContent = getGradeLevel(gpa);
            
            document.getElementById('resultSection').style.display = 'block';
            document.getElementById('resultSection').classList.add('fade-in');
        }

        // 엔터키로 계산
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && e.target.tagName !== 'TEXTAREA') {
                calculate();
            }
        });

        // 초기화
        window.onload = function() {
            updateGradeInfo();
        };
    </script>
</body>
</html>