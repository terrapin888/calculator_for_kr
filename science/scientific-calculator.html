<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>공학용 계산기 - CalcHub | 과학 및 수학 계산</title>
    <meta name="description" content="공학용 계산기로 삼각함수, 로그, 지수 등 고급 수학 계산을 간편하게 하세요. 수식 자동 인식.">
    <meta name="keywords" content="공학용계산기, 과학계산기, 삼각함수, 로그함수">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/common.css">
</head>
<body>
    <!-- 공통 헤더 -->
    <header class="header">
        <div class="header-content">
            <a href="../index.html" class="logo">
                <div class="logo-icon">🧮</div>
                CalcHub
            </a>
            <nav class="nav-links">
                <a href="../index.html#calculators" class="nav-link">계산기</a>
                <a href="../about.html" class="nav-link">소개</a>
                <a href="../contact.html" class="nav-link">문의</a>
            </nav>
        </div>
    </header>

    <div class="container">
        <div class="calculator-card">
            <!-- 계산기 헤더 -->
            <div class="calculator-header">
                <h1 class="calculator-title">🧮 공학용 계산기</h1>
                <p class="calculator-subtitle">고급 수학 함수와 과학 계산을 간편하게</p>
            </div>

            <!-- 계산기 본문 -->
            <div class="calculator-body">
                <!-- 입력 섹션 -->
                <div class="input-section">
                    <h2 class="section-title">📐 수식 입력</h2>
                    <div class="input-grid">
                        <div class="input-group">
                            <label for="expression" class="input-label">수식</label>
                            <input type="text" id="expression" class="input-field" 
                                placeholder="예: sin(30), log(100), 2^3, sqrt(16)">
                        </div>
                        <div class="input-group">
                            <label for="angleUnit" class="input-label">각도 단위</label>
                            <select id="angleUnit" class="input-field">
                                <option value="degree">도 (Degree)</option>
                                <option value="radian">라디안 (Radian)</option>
                            </select>
                        </div>
                    </div>
                    <div class="btn-grid">
                        <button onclick="insertFunction('sin(')" class="btn btn-outline">sin</button>
                        <button onclick="insertFunction('cos(')" class="btn btn-outline">cos</button>
                        <button onclick="insertFunction('tan(')" class="btn btn-outline">tan</button>
                        <button onclick="insertFunction('log(')" class="btn btn-outline">log</button>
                        <button onclick="insertFunction('ln(')" class="btn btn-outline">ln</button>
                        <button onclick="insertFunction('sqrt(')" class="btn btn-outline">√</button>
                    </div>
                    <button onclick="calculate()" class="btn btn-primary">계산하기</button>
                </div>

                <!-- 결과 섹션 -->
                <div id="resultSection" class="result-section" style="display: none;">
                    <h2 class="result-title">📋 계산 결과</h2>
                    <div class="result-grid">
                        <div class="result-item">
                            <div class="result-label">결과</div>
                            <div id="calcResult" class="result-value highlight">-</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">수식</div>
                            <div id="parsedExpression" class="result-value">-</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 수식에 함수 삽입
        function insertFunction(func) {
            const input = document.getElementById('expression');
            const cursorPos = input.selectionStart;
            const textBefore = input.value.substring(0, cursorPos);
            const textAfter = input.value.substring(cursorPos);
            
            input.value = textBefore + func + textAfter;
            input.focus();
            input.setSelectionRange(cursorPos + func.length, cursorPos + func.length);
        }

        // 각도 변환 함수
        function degreeToRadian(degree) {
            return degree * Math.PI / 180;
        }

        function radianToDegree(radian) {
            return radian * 180 / Math.PI;
        }

        // 수식 파싱 및 계산 함수
        function parseAndCalculate(expression, angleUnit) {
            // 한국어 함수명 지원
            expression = expression.replace(/사인|sine?/gi, 'sin');
            expression = expression.replace(/코사인|cosine?/gi, 'cos');
            expression = expression.replace(/탄젠트|tangent?/gi, 'tan');
            expression = expression.replace(/로그|log10/gi, 'log');
            expression = expression.replace(/자연로그|ln/gi, 'ln');
            expression = expression.replace(/제곱근|루트|sqrt/gi, 'sqrt');
            expression = expression.replace(/파이|π/gi, 'Math.PI');
            expression = expression.replace(/e/gi, 'Math.E');
            
            // 삼각함수에 각도 단위 적용
            if (angleUnit === 'degree') {
                expression = expression.replace(/sin\s*\(\s*([^)]+)\s*\)/g, 'Math.sin(degreeToRadian($1))');
                expression = expression.replace(/cos\s*\(\s*([^)]+)\s*\)/g, 'Math.cos(degreeToRadian($1))');
                expression = expression.replace(/tan\s*\(\s*([^)]+)\s*\)/g, 'Math.tan(degreeToRadian($1))');
            } else {
                expression = expression.replace(/sin\s*\(\s*([^)]+)\s*\)/g, 'Math.sin($1)');
                expression = expression.replace(/cos\s*\(\s*([^)]+)\s*\)/g, 'Math.cos($1)');
                expression = expression.replace(/tan\s*\(\s*([^)]+)\s*\)/g, 'Math.tan($1)');
            }
            
            // 기타 함수들 변환
            expression = expression.replace(/log\s*\(\s*([^)]+)\s*\)/g, 'Math.log10($1)');
            expression = expression.replace(/ln\s*\(\s*([^)]+)\s*\)/g, 'Math.log($1)');
            expression = expression.replace(/sqrt\s*\(\s*([^)]+)\s*\)/g, 'Math.sqrt($1)');
            expression = expression.replace(/abs\s*\(\s*([^)]+)\s*\)/g, 'Math.abs($1)');
            
            // ^ (거듭제곱)을 Math.pow로 변환
            expression = expression.replace(/([^*+\-/\s()]+)\s*\^\s*([^*+\-/\s()]+)/g, 'Math.pow($1, $2)');
            
            // ! (팩토리얼) 계산
            expression = expression.replace(/(\d+)!/g, function(match, n) {
                const num = parseInt(n);
                let result = 1;
                for (let i = 2; i <= num; i++) {
                    result *= i;
                }
                return result.toString();
            });
            
            return expression;
        }

        // 계산 함수
        function calculate() {
            const expressionInput = document.getElementById('expression').value;
            const angleUnit = document.getElementById('angleUnit').value;
            
            if (!expressionInput.trim()) {
                alert('수식을 입력해주세요');
                return;
            }

            try {
                const parsedExpression = parseAndCalculate(expressionInput, angleUnit);
                
                // 안전한 계산을 위해 eval 대신 Function 사용
                const result = new Function('degreeToRadian', 'radianToDegree', 'Math', `return ${parsedExpression}`)(
                    degreeToRadian,
                    radianToDegree,
                    Math
                );
                
                if (isNaN(result)) {
                    throw new Error('올바르지 않은 수식입니다');
                }
                
                // 결과가 너무 작거나 클 때 과학적 표기법 사용
                let formattedResult;
                if (Math.abs(result) < 0.000001 || Math.abs(result) > 1000000) {
                    formattedResult = result.toExponential(6);
                } else {
                    formattedResult = parseFloat(result.toFixed(10)).toString();
                }
                
                // 결과 표시
                document.getElementById('calcResult').textContent = formattedResult;
                document.getElementById('parsedExpression').textContent = expressionInput;
                
                document.getElementById('resultSection').style.display = 'block';
                document.getElementById('resultSection').classList.add('fade-in');
                
            } catch (error) {
                alert('계산 중 오류가 발생했습니다. 수식을 확인해주세요.');
                console.error('계산 오류:', error);
            }
        }

        // 엔터키로 계산
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                calculate();
            }
        });

        // 초기 예제 설정
        window.onload = function() {
            document.getElementById('expression').value = 'sin(30) + cos(60)';
        };
    </script>
</body>
</html>