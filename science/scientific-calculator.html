<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³µí•™ìš© ê³„ì‚°ê¸° - CalcHub | ê³¼í•™ ë° ìˆ˜í•™ ê³„ì‚°</title>
    <meta name="description" content="ê³µí•™ìš© ê³„ì‚°ê¸°ë¡œ ì‚¼ê°í•¨ìˆ˜, ë¡œê·¸, ì§€ìˆ˜ ë“± ê³ ê¸‰ ìˆ˜í•™ ê³„ì‚°ì„ ê°„í¸í•˜ê²Œ í•˜ì„¸ìš”. ìˆ˜ì‹ ìë™ ì¸ì‹.">
    <meta name="keywords" content="ê³µí•™ìš©ê³„ì‚°ê¸°, ê³¼í•™ê³„ì‚°ê¸°, ì‚¼ê°í•¨ìˆ˜, ë¡œê·¸í•¨ìˆ˜">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/common.css">
</head>
<body>
    <!-- ê³µí†µ í—¤ë” -->
    <header class="header">
        <div class="header-content">
            <a href="../index.html" class="logo">
                <div class="logo-icon">ğŸ§®</div>
                CalcHub
            </a>
            <nav class="nav-links">
                <a href="../index.html#calculators" class="nav-link">ê³„ì‚°ê¸°</a>
                <a href="../about.html" class="nav-link">ì†Œê°œ</a>
                <a href="../contact.html" class="nav-link">ë¬¸ì˜</a>
            </nav>
        </div>
    </header>

    <div class="container">
        <div class="calculator-card">
            <!-- ê³„ì‚°ê¸° í—¤ë” -->
            <div class="calculator-header">
                <h1 class="calculator-title">ğŸ§® ê³µí•™ìš© ê³„ì‚°ê¸°</h1>
                <p class="calculator-subtitle">ê³ ê¸‰ ìˆ˜í•™ í•¨ìˆ˜ì™€ ê³¼í•™ ê³„ì‚°ì„ ê°„í¸í•˜ê²Œ</p>
            </div>

            <!-- ê³„ì‚°ê¸° ë³¸ë¬¸ -->
            <div class="calculator-body">
                <!-- ì…ë ¥ ì„¹ì…˜ -->
                <div class="input-section">
                    <h2 class="section-title">ğŸ“ ìˆ˜ì‹ ì…ë ¥</h2>
                    <div class="input-grid">
                        <div class="input-group">
                            <label for="expression" class="input-label">ìˆ˜ì‹</label>
                            <input type="text" id="expression" class="input-field" 
                                placeholder="ì˜ˆ: sin(30), log(100), 2^3, sqrt(16)">
                        </div>
                        <div class="input-group">
                            <label for="angleUnit" class="input-label">ê°ë„ ë‹¨ìœ„</label>
                            <select id="angleUnit" class="input-field">
                                <option value="degree">ë„ (Degree)</option>
                                <option value="radian">ë¼ë””ì•ˆ (Radian)</option>
                            </select>
                        </div>
                    </div>
                    <div class="btn-grid">
                        <button onclick="insertFunction('sin(')" class="btn btn-outline">sin</button>
                        <button onclick="insertFunction('cos(')" class="btn btn-outline">cos</button>
                        <button onclick="insertFunction('tan(')" class="btn btn-outline">tan</button>
                        <button onclick="insertFunction('log(')" class="btn btn-outline">log</button>
                        <button onclick="insertFunction('ln(')" class="btn btn-outline">ln</button>
                        <button onclick="insertFunction('sqrt(')" class="btn btn-outline">âˆš</button>
                    </div>
                    <button onclick="calculate()" class="btn btn-primary">ê³„ì‚°í•˜ê¸°</button>
                </div>

                <!-- ê²°ê³¼ ì„¹ì…˜ -->
                <div id="resultSection" class="result-section" style="display: none;">
                    <h2 class="result-title">ğŸ“‹ ê³„ì‚° ê²°ê³¼</h2>
                    <div class="result-grid">
                        <div class="result-item">
                            <div class="result-label">ê²°ê³¼</div>
                            <div id="calcResult" class="result-value highlight">-</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">ìˆ˜ì‹</div>
                            <div id="parsedExpression" class="result-value">-</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ìˆ˜ì‹ì— í•¨ìˆ˜ ì‚½ì…
        function insertFunction(func) {
            const input = document.getElementById('expression');
            const cursorPos = input.selectionStart;
            const textBefore = input.value.substring(0, cursorPos);
            const textAfter = input.value.substring(cursorPos);
            
            input.value = textBefore + func + textAfter;
            input.focus();
            input.setSelectionRange(cursorPos + func.length, cursorPos + func.length);
        }

        // ê°ë„ ë³€í™˜ í•¨ìˆ˜
        function degreeToRadian(degree) {
            return degree * Math.PI / 180;
        }

        function radianToDegree(radian) {
            return radian * 180 / Math.PI;
        }

        // ìˆ˜ì‹ íŒŒì‹± ë° ê³„ì‚° í•¨ìˆ˜
        function parseAndCalculate(expression, angleUnit) {
            // í•œêµ­ì–´ í•¨ìˆ˜ëª… ì§€ì›
            expression = expression.replace(/ì‚¬ì¸|sine?/gi, 'sin');
            expression = expression.replace(/ì½”ì‚¬ì¸|cosine?/gi, 'cos');
            expression = expression.replace(/íƒ„ì  íŠ¸|tangent?/gi, 'tan');
            expression = expression.replace(/ë¡œê·¸|log10/gi, 'log');
            expression = expression.replace(/ìì—°ë¡œê·¸|ln/gi, 'ln');
            expression = expression.replace(/ì œê³±ê·¼|ë£¨íŠ¸|sqrt/gi, 'sqrt');
            expression = expression.replace(/íŒŒì´|Ï€/gi, 'Math.PI');
            expression = expression.replace(/e/gi, 'Math.E');
            
            // ì‚¼ê°í•¨ìˆ˜ì— ê°ë„ ë‹¨ìœ„ ì ìš©
            if (angleUnit === 'degree') {
                expression = expression.replace(/sin\s*\(\s*([^)]+)\s*\)/g, 'Math.sin(degreeToRadian($1))');
                expression = expression.replace(/cos\s*\(\s*([^)]+)\s*\)/g, 'Math.cos(degreeToRadian($1))');
                expression = expression.replace(/tan\s*\(\s*([^)]+)\s*\)/g, 'Math.tan(degreeToRadian($1))');
            } else {
                expression = expression.replace(/sin\s*\(\s*([^)]+)\s*\)/g, 'Math.sin($1)');
                expression = expression.replace(/cos\s*\(\s*([^)]+)\s*\)/g, 'Math.cos($1)');
                expression = expression.replace(/tan\s*\(\s*([^)]+)\s*\)/g, 'Math.tan($1)');
            }
            
            // ê¸°íƒ€ í•¨ìˆ˜ë“¤ ë³€í™˜
            expression = expression.replace(/log\s*\(\s*([^)]+)\s*\)/g, 'Math.log10($1)');
            expression = expression.replace(/ln\s*\(\s*([^)]+)\s*\)/g, 'Math.log($1)');
            expression = expression.replace(/sqrt\s*\(\s*([^)]+)\s*\)/g, 'Math.sqrt($1)');
            expression = expression.replace(/abs\s*\(\s*([^)]+)\s*\)/g, 'Math.abs($1)');
            
            // ^ (ê±°ë“­ì œê³±)ì„ Math.powë¡œ ë³€í™˜
            expression = expression.replace(/([^*+\-/\s()]+)\s*\^\s*([^*+\-/\s()]+)/g, 'Math.pow($1, $2)');
            
            // ! (íŒ©í† ë¦¬ì–¼) ê³„ì‚°
            expression = expression.replace(/(\d+)!/g, function(match, n) {
                const num = parseInt(n);
                let result = 1;
                for (let i = 2; i <= num; i++) {
                    result *= i;
                }
                return result.toString();
            });
            
            return expression;
        }

        // ê³„ì‚° í•¨ìˆ˜
        function calculate() {
            const expressionInput = document.getElementById('expression').value;
            const angleUnit = document.getElementById('angleUnit').value;
            
            if (!expressionInput.trim()) {
                alert('ìˆ˜ì‹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }

            try {
                const parsedExpression = parseAndCalculate(expressionInput, angleUnit);
                
                // ì•ˆì „í•œ ê³„ì‚°ì„ ìœ„í•´ eval ëŒ€ì‹  Function ì‚¬ìš©
                const result = new Function('degreeToRadian', 'radianToDegree', 'Math', `return ${parsedExpression}`)(
                    degreeToRadian,
                    radianToDegree,
                    Math
                );
                
                if (isNaN(result)) {
                    throw new Error('ì˜¬ë°”ë¥´ì§€ ì•Šì€ ìˆ˜ì‹ì…ë‹ˆë‹¤');
                }
                
                // ê²°ê³¼ê°€ ë„ˆë¬´ ì‘ê±°ë‚˜ í´ ë•Œ ê³¼í•™ì  í‘œê¸°ë²• ì‚¬ìš©
                let formattedResult;
                if (Math.abs(result) < 0.000001 || Math.abs(result) > 1000000) {
                    formattedResult = result.toExponential(6);
                } else {
                    formattedResult = parseFloat(result.toFixed(10)).toString();
                }
                
                // ê²°ê³¼ í‘œì‹œ
                document.getElementById('calcResult').textContent = formattedResult;
                document.getElementById('parsedExpression').textContent = expressionInput;
                
                document.getElementById('resultSection').style.display = 'block';
                document.getElementById('resultSection').classList.add('fade-in');
                
            } catch (error) {
                alert('ê³„ì‚° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ìˆ˜ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                console.error('ê³„ì‚° ì˜¤ë¥˜:', error);
            }
        }

        // ì—”í„°í‚¤ë¡œ ê³„ì‚°
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                calculate();
            }
        });

        // ì´ˆê¸° ì˜ˆì œ ì„¤ì •
        window.onload = function() {
            document.getElementById('expression').value = 'sin(30) + cos(60)';
        };
    </script>
</body>
</html>